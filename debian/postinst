#DEBHELPER#

sysUser="ffpu"

if ! id $sysUser &>/dev/null; then
    adduser --system --no-create-home $sysUser
fi

if [ ! -d "/usr/share/ffplayout/db" ]; then
    mkdir "/usr/share/ffplayout/db"
    mkdir -p "/var/lib/ffplayout/playlists"
    mkdir "/var/lib/ffplayout/tv-media"

    /usr/bin/ffpapi -i

    chown -R ${sysUser}. "/usr/share/ffplayout"
    chown -R ${sysUser}. "/var/lib/ffplayout"
    chown -R ${sysUser}. "/etc/ffplayout"
fi

if [ ! -d "/var/log/ffplayout" ]; then
    mkdir "/var/log/ffplayout"

    chown ${sysUser}. "/var/log/ffplayout"
fi

tar xf "/usr/share/ffplayout/public.tar.gz" --overwrite -C "/usr/share/ffplayout/"
ln -s "/var/lib/ffplayout/tv-media" "/usr/share/ffplayout/public/"
chown -R ${sysUser}. "/usr/share/ffplayout/public"
yes | rm "/usr/share/ffplayout/public.tar.gz"
